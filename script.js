const POINT_CORRECT=5,POINT_WRONG=-2,POINT_SKIP=-1,TIME_PER_Q=40;
function simpleHash(s){let h=0;for(let i=0;i<s.length;i++){h=(h<<5)-h+s.charCodeAt(i);h|=0}return h.toString(16);}function generateAccessCode(len=6){const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';let out='';for(let i=0;i<len;i++){out+=chars[Math.floor(Math.random()*chars.length)];}return out;}function saveUserObj(u){const users=JSON.parse(localStorage.getItem('govt_users')||'{}');users[u.email]=u;localStorage.setItem('govt_users',JSON.stringify(users));}function getUserObj(e){const users=JSON.parse(localStorage.getItem('govt_users')||'{}');return users[e]||null;}const QUESTIONS_DB={"quantitative_aptitude": [{"q": "If 12 men can complete a work in 18 days, how many days will 9 men take to complete the same work?", "options": ["20", "24", "36", "18"], "answer": 1}, {"q": "If the LCM of two numbers is 180 and their HCF is 6, and one number is 30, the other number is?", "options": ["24", "36", "48", "54"], "answer": 1}, {"q": "Solve for x: 2x + 3 = 11", "options": ["3", "4", "5", "6"], "answer": 1}, {"q": "If a sum of money doubles in 8 years at simple interest, the rate of interest per annum is?", "options": ["10%", "8%", "12.5%", "16%"], "answer": 2}, {"q": "What is the next number in the series: 2, 6, 12, 20, 30, ?", "options": ["36", "40", "42", "46"], "answer": 2}, {"q": "If perimeter of a square is 48 cm, area is?", "options": ["144 cm\u00b2", "256 cm\u00b2", "196 cm\u00b2", "64 cm\u00b2"], "answer": 0}, {"q": "Value of 7C2 (7 choose 2) is?", "options": ["14", "21", "35", "28"], "answer": 1}, {"q": "If a:b = 3:4 and b:c = 5:6, find a:c.", "options": ["3:6", "5:8", "15:18", "1:2"], "answer": 1}, {"q": "If x^2 - 5x + 6 = 0, roots are?", "options": ["1 and 6", "2 and 3", "-2 and -3", "3 and 2"], "answer": 1}, {"q": "Average of first 9 natural numbers is?", "options": ["4.5", "5", "5.5", "6"], "answer": 1}, {"q": "If price is increased by 20% then decreased by 20%, net change is?", "options": ["Increase of 4%", "Decrease of 4%", "No change", "Decrease of 2%"], "answer": 1}, {"q": "If a train runs at 60 km/h, how far does it travel in 45 minutes?", "options": ["30 km", "45 km", "60 km", "75 km"], "answer": 1}, {"q": "If log10(1000) = ?", "options": ["2", "3", "10", "100"], "answer": 1}, {"q": "If 5x = 20, then x^2 equals?", "options": ["4", "16", "25", "20"], "answer": 1}, {"q": "A number is 20% more than 50. What is the number?", "options": ["60", "70", "55", "50"], "answer": 0}, {"q": "If compound interest on \u20b91000 at 10% for 2 years is?", "options": ["\u20b9200", "\u20b9210", "\u20b9220", "\u20b9180"], "answer": 1}, {"q": "Solve for x: 3x - 7 = 2x + 5", "options": ["-12", "2", "8", "12"], "answer": 3}, {"q": "If probability of a single event is 1/5, probability of success in 3 independent trials at least once is?", "options": ["(1/5)^3", "(4/5)^3", "1 - (4/5)^3", "3*(1/5)"], "answer": 2}, {"q": "If two angles of a triangle are 35\u00b0 and 65\u00b0, the third angle is?", "options": ["80\u00b0", "90\u00b0", "85\u00b0", "70\u00b0"], "answer": 0}, {"q": "If 20% of a number is 40, the number is?", "options": ["160", "180", "200", "240"], "answer": 2}], "logical_reasoning": [{"q": "Find the odd one out: 7, 11, 13, 17, 19, 21", "options": ["11", "13", "17", "21"], "answer": 3}, {"q": "If A is brother of B, and B is sister of C, and C is father of D, how is A related to D?", "options": ["Brother", "Uncle", "Father", "Nephew"], "answer": 1}, {"q": "Find the next in series: 1, 4, 9, 16, 25, ?", "options": ["30", "35", "36", "49"], "answer": 2}, {"q": "If in a code MISS -> NITT, then BOLD -> ?", "options": ["CONE", "COKE", "COLE", "CONE"], "answer": 0}, {"q": "Select the mirror image of 'bq'", "options": ["pq", "db", "bd", "qb"], "answer": 1}, {"q": "In a row of 20 people, every 3rd person is selected starting from 2nd. Which positions selected among first 12?", "options": ["2,5,8,11", "3,6,9,12", "1,4,7,10", "2,6,9,12"], "answer": 0}, {"q": "If all Bloops are Razzies and all Razzies are Lazzies, which is true?", "options": ["All Bloops are Lazzies", "All Lazzies are Bloops", "No Bloops are Lazzies", "Some Bloops are not Lazzies"], "answer": 0}, {"q": "Find missing letter: A, C, F, J, O, ?", "options": ["T", "U", "V", "S"], "answer": 1}, {"q": "Which shape has rotational symmetry of order 4?", "options": ["Rectangle", "Trapezoid", "Square", "Rhombus"], "answer": 2}, {"q": "If 5 workers build 5 walls in 5 days, how many workers to build 10 walls in 5 days?", "options": ["5", "8", "10", "15"], "answer": 2}, {"q": "Find the code: if CAT=3120 and DOG=41514, BAT=?", "options": ["2120", "2130", "3120", "4120"], "answer": 0}, {"q": "Arrange: Clock, Face, Hand, Minute, Time in meaningful order", "options": ["Clock Face Hand Minute Time", "Face Clock Time Hand Minute", "Clock Hand Face Minute Time", "Clock Time Face Hand Minute"], "answer": 0}, {"q": "Find missing: 2,5,10,17,26,?", "options": ["34", "36", "37", "40"], "answer": 2}, {"q": "Which is odd one out: Apple, Orange, Banana, Carrot", "options": ["Apple", "Banana", "Orange", "Carrot"], "answer": 3}, {"q": "If today is Monday, what day after 100 days?", "options": ["Wednesday", "Thursday", "Friday", "Saturday"], "answer": 1}, {"q": "How many distinct arrangements of 'EXAM'?", "options": ["12", "24", "16", "20"], "answer": 1}, {"q": "If product of two consecutive integers is 182, integers are?", "options": ["11 and 12", "12 and 13", "13 and 14", "14 and 15"], "answer": 2}, {"q": "Find next: 3,8,15,24,35,?", "options": ["46", "48", "49", "50"], "answer": 1}, {"q": "Syllogism: All X are Y. Some Y are Z. Does 'Some Z are X' follow?", "options": ["Yes", "No", "Cannot say", "Sometimes"], "answer": 1}, {"q": "If letters AZ,BY,CX,... next is?", "options": ["DW", "EV", "EU", "FV"], "answer": 0}], "general_knowledge": [{"q": "Who was the first President of India?", "options": ["Dr. Rajendra Prasad", "Dr. S Radhakrishnan", "Jawaharlal Nehru", "B R Ambedkar"], "answer": 0}, {"q": "Which is the largest organ in the human body?", "options": ["Liver", "Skin", "Heart", "Lungs"], "answer": 1}, {"q": "The Chipko movement was mainly about?", "options": ["Forest conservation", "Soil conservation", "Water conservation", "Wildlife protection"], "answer": 0}, {"q": "Which river is known as 'Sorrow of Bihar'?", "options": ["Ganges", "Kosi", "Son", "Ghaghara"], "answer": 1}, {"q": "Who wrote the Indian national anthem?", "options": ["Rabindranath Tagore", "Bankim Chandra Chatterjee", "Sarojini Naidu", "Subhash Chandra Bose"], "answer": 0}, {"q": "Capital of Australia?", "options": ["Sydney", "Melbourne", "Canberra", "Perth"], "answer": 2}, {"q": "Which gas is most abundant in Earth's atmosphere?", "options": ["Oxygen", "Nitrogen", "Carbon dioxide", "Argon"], "answer": 1}, {"q": "Which protocol is used to fetch web pages?", "options": ["HTTP", "FTP", "SMTP", "SSH"], "answer": 0}, {"q": "Which mountain is the highest?", "options": ["K2", "Mount Everest", "Kangchenjunga", "Lhotse"], "answer": 1}, {"q": "Who is known as the 'Father of the Indian Constitution'?", "options": ["B R Ambedkar", "Mahatma Gandhi", "Jawaharlal Nehru", "Sardar Patel"], "answer": 0}, {"q": "Which planet is known for its rings?", "options": ["Saturn", "Jupiter", "Neptune", "Uranus"], "answer": 0}, {"q": "Which element has atomic number 1?", "options": ["Hydrogen", "Helium", "Oxygen", "Carbon"], "answer": 0}, {"q": "Name the sea between India and Sri Lanka?", "options": ["Arabian Sea", "Bay of Bengal", "Palk Strait", "Laccadive Sea"], "answer": 2}, {"q": "Which is the world's largest democracy?", "options": ["USA", "India", "Indonesia", "Brazil"], "answer": 1}, {"q": "Who painted the Mona Lisa?", "options": ["Leonardo da Vinci", "Michelangelo", "Raphael", "Van Gogh"], "answer": 0}, {"q": "What is the currency of Japan?", "options": ["Yuan", "Dollar", "Won", "Yen"], "answer": 3}, {"q": "Which organelle is the powerhouse of the cell?", "options": ["Nucleus", "Mitochondria", "Ribosome", "Golgi apparatus"], "answer": 1}, {"q": "Which sea creature has eight arms?", "options": ["Squid", "Octopus", "Jellyfish", "Shark"], "answer": 1}, {"q": "Which language is the Constitution of India written in originally?", "options": ["Hindi", "English", "Sanskrit", "Urdu"], "answer": 1}, {"q": "Which is the longest river in India?", "options": ["Ganga", "Yamuna", "Godavari", "Narmada"], "answer": 0}], "current_affairs": [{"q": "Which country hosted the G20 Summit in 2023?", "options": ["India", "USA", "Japan", "France"], "answer": 0}, {"q": "Which city hosted the Summer Olympics in 2024?", "options": ["Los Angeles", "Tokyo", "Paris", "Beijing"], "answer": 2}, {"q": "Which country became the first to approve commercial sale of cultivated meat?", "options": ["USA", "Singapore", "Israel", "Japan"], "answer": 1}, {"q": "Which global initiative focuses on eliminating single-use plastics (recent treaty)?", "options": ["UN Plastics Treaty", "WTO Plastics Pact", "EU Plastics Act", "WHO Plastics Program"], "answer": 0}, {"q": "Which tech company launched a major open-source AI model in the early 2020s?", "options": ["OpenAI", "Meta", "Google", "Microsoft"], "answer": 0}, {"q": "Which country joined BRICS expansion recently (early 2020s)?", "options": ["Argentina", "Saudi Arabia", "Egypt", "Turkey"], "answer": 1}, {"q": "Which country hosted COP26 climate conference?", "options": ["UK (Glasgow)", "Italy", "Canada", "Germany"], "answer": 0}, {"q": "Which vaccine tech enabled rapid COVID-19 vaccine development?", "options": ["mRNA lipid nanoparticle", "Inactivated virus", "Protein subunit", "Adenoviral vector"], "answer": 0}, {"q": "Which country announced moon base cooperation proposals recently?", "options": ["China", "India", "USA", "Russia"], "answer": 0}, {"q": "Which organisation regulates digital services in EU via the DSA?", "options": ["European Union", "United Nations", "OECD", "G20"], "answer": 0}, {"q": "Which company acquired Twitter and renamed it X?", "options": ["Elon Musk's acquisition", "Mark Zuckerberg's acquisition", "Jack Dorsey's acquisition", "None"], "answer": 0}, {"q": "Which country announced large investments into green hydrogen projects?", "options": ["Australia", "India", "Saudi Arabia", "Japan"], "answer": 0}, {"q": "Which country hosted a major earthquake in 2024 requiring international aid?", "options": ["Turkey\u2013Syria region", "Japan", "Chile", "Nepal"], "answer": 0}, {"q": "Which organisation launched programmes for rural electrification microgrids?", "options": ["World Bank/UN", "WHO", "WTO", "IMF"], "answer": 0}, {"q": "Which country was the host of the 2023 Cricket World Cup final? (example)", "options": ["India", "England", "Australia", "South Africa"], "answer": 0}, {"q": "Which bank raised US interest rates sharply in 2024 to fight inflation?", "options": ["Federal Reserve", "ECB", "Bank of Japan", "People's Bank of China"], "answer": 0}, {"q": "Which international court has heard climate cases recently?", "options": ["International Court of Justice", "ICC", "WTO", "IMF"], "answer": 0}, {"q": "Which major sporting event was held in Paris in 2024?", "options": ["Summer Olympics 2024", "FIFA World Cup 2024", "Commonwealth Games", "Asian Games"], "answer": 0}, {"q": "Which country announced accelerated EV subsidies to meet net-zero targets?", "options": ["United Kingdom", "Canada", "Brazil", "Mexico"], "answer": 0}, {"q": "Which global initiative helps provide microgrids to remote communities?", "options": ["World Bank/UN", "WTO", "WHO", "IMF"], "answer": 0}], "english_language": [{"q": "Choose the synonym of 'Eloquent'.", "options": ["Fluent", "Silent", "Harsh", "Weak"], "answer": 0}, {"q": "Choose the antonym of 'Abundant'.", "options": ["Scarce", "Plentiful", "Many", "Ample"], "answer": 0}, {"q": "Select the correct sentence.", "options": ["She has lived here since 2010.", "She lived here since 2010.", "She has been living here since 2010.", "She lives here since 2010."], "answer": 0}, {"q": "Choose the correct article: _____ university is two hours away.", "options": ["A", "An", "The", "No article"], "answer": 0}, {"q": "Fill in the blank: He is good _____ playing chess.", "options": ["at", "in", "on", "with"], "answer": 0}, {"q": "Choose synonym of 'Obsolete'.", "options": ["Outdated", "Modern", "New", "Current"], "answer": 0}, {"q": "Choose correct preposition: I will meet you _____ Monday.", "options": ["on", "in", "at", "by"], "answer": 0}, {"q": "Identify the adverb in: She sang beautifully.", "options": ["beautifully", "She", "sang", "none"], "answer": 0}, {"q": "Choose correct spelling.", "options": ["Accommodate", "Acommodate", "Accomodate", "Acommadate"], "answer": 0}, {"q": "Pick the word closest in meaning to 'mitigate'.", "options": ["Alleviate", "Exacerbate", "Increase", "Ignore"], "answer": 0}, {"q": "Choose passive voice: 'They will finish the work.'", "options": ["The work will be finished by them.", "The work will finish them.", "The work is finished by them.", "They will be finished by the work."], "answer": 0}, {"q": "Fill: If I _____ you, I would apologize.", "options": ["were", "was", "am", "will be"], "answer": 0}, {"q": "Choose plural form of 'Crisis'.", "options": ["Crises", "Crisises", "Crisis", "Crisis"], "answer": 0}, {"q": "Select correct comparative: 'This problem is _____ than the last.'", "options": ["harder", "more hard", "hardest", "most hard"], "answer": 0}, {"q": "Choose correct phrasal verb: 'Give _____' meaning surrender.", "options": ["up", "in", "off", "out"], "answer": 0}, {"q": "Which is a conjunction?", "options": ["And", "Quickly", "Blue", "Under"], "answer": 0}, {"q": "Choose synonym of 'brief'.", "options": ["Concise", "Lengthy", "Verbose", "Huge"], "answer": 0}, {"q": "Pick the correctly punctuated sentence.", "options": ["He said, 'I'll be late.'", "He said 'I'll be late'.", "He said I'll be late.", "He said I'll be late."], "answer": 0}, {"q": "Choose correct tense: 'By next year I _____ this book.'", "options": ["will have finished", "will finish", "finish", "have finished"], "answer": 0}, {"q": "Find the error: 'Each of the students have finished their work.'", "options": ["have -> has", "their -> his/her", "Each -> All", "students -> student"], "answer": 0}]};


/* Signup page */
if(location.pathname.endsWith('signup.html')||location.pathname.endsWith('/')){
  const f=document.getElementById('signupForm'),toLogin=document.getElementById('tologin'),msg=document.getElementById('signupMsg');
  f.addEventListener('submit',e=>{e.preventDefault();const name=document.getElementById('name').value.trim(),email=document.getElementById('email').value.trim().toLowerCase(),qual=document.getElementById('qual').value.trim(),pass=document.getElementById('password').value;if(!name||!email||!qual||!pass){msg.innerText='Fill all fields';return;}if(getUserObj(email)){msg.innerText='User exists. Please login.';return;}const code=generateAccessCode(),user={name,email,qual,passHash:simpleHash(pass),accessCode:code,history:[]};saveUserObj(user);msg.innerHTML='Signup successful! Your Access Code: <strong style="color:#0b74a6">'+code+'</strong>';const b=document.createElement('button');b.className='btn outline';b.innerText='Copy Code';b.onclick=()=>{navigator.clipboard.writeText(code);b.innerText='Copied';};msg.appendChild(b);});if(toLogin)toLogin.addEventListener('click',()=>location.href='login.html');}

/* Login page */
if(location.pathname.endsWith('login.html')){
  const f=document.getElementById('loginForm'),back=document.getElementById('backSignup'),msg=document.getElementById('loginMsg');
  f.addEventListener('submit',e=>{e.preventDefault();const email=document.getElementById('li_email').value.trim().toLowerCase(),pass=document.getElementById('li_password').value,code=document.getElementById('li_code').value.trim();const user=getUserObj(email);if(!user){msg.innerText='No account with this email.';return;}if(code){if(user.passHash!==simpleHash(pass)){msg.innerText='Incorrect password.';return;}if(user.accessCode!==code){msg.innerText='Invalid access code.';return;}sessionStorage.setItem('govt_current',JSON.stringify({email}));location.href='select.html';return;}if(user.passHash!==simpleHash(pass)){msg.innerText='Incorrect password.';return;}const newCode=generateAccessCode();user.accessCode=newCode;saveUserObj(user);msg.innerHTML='Logged in. New Access Code: <strong style="color:#0b74a6">'+newCode+'</strong>';sessionStorage.setItem('govt_current',JSON.stringify({email}));setTimeout(()=>location.href='select.html',1200);});if(back)back.addEventListener('click',()=>location.href='index.html');}

/* Select page */
if(location.pathname.endsWith('select.html')){
  const cur=JSON.parse(sessionStorage.getItem('govt_current')||'null');if(!cur)location.href='login.html';document.querySelectorAll('.subject').forEach(b=>b.addEventListener('click',()=>{sessionStorage.setItem('govt_selected_sub',b.dataset.sub);location.href='exam.html'}));document.getElementById('logout').addEventListener('click',()=>{sessionStorage.removeItem('govt_current');location.href='index.html'});
}

/* Exam page */
if(location.pathname.endsWith('exam.html')){
  const cur=JSON.parse(sessionStorage.getItem('govt_current')||'null');if(!cur){location.href='login.html'}const user=getUserObj(cur.email);const domainNameEl=document.getElementById('domainName'),userNameEl=document.getElementById('userName'),qBox=document.getElementById('questionBox'),oBox=document.getElementById('optionsBox'),submitBtn=document.getElementById('submitBtn'),skipBtn=document.getElementById('skipBtn'),endBtn=document.getElementById('endBtn'),timeEl=document.getElementById('time'),timerBar=document.getElementById('timerBar'),reveal=document.getElementById('reveal'),scoreEl=document.getElementById('score'),qIndexEl=document.getElementById('qIndex'),qTotalEl=document.getElementById('qTotal');let domain=sessionStorage.getItem('govt_selected_sub')||'quantitative_aptitude';domainNameEl.innerText=domain.replace(/_/g,' ');userNameEl.innerText=user.name;let pool=QUESTIONS_DB[domain].slice();for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}const TOTAL=pool.length;let index=0,score=0,timer=null,timeLeft=TIME_PER_Q;qTotalEl.innerText=TOTAL;updateUI();function renderOptions(item){oBox.innerHTML='';item.options.forEach((opt,i)=>{const btn=document.createElement('button');btn.className='opt-btn';btn.innerText=String.fromCharCode(65+i)+'. '+opt;btn.dataset.idx=i;btn.addEventListener('click',()=>{oBox.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('selected'));btn.classList.add('selected')});oBox.appendChild(btn)})}function updateUI(){clearInterval(timer);scoreEl.innerText=score;qIndexEl.innerText=index+1;qBox.innerText=pool[index].q;renderOptions(pool[index]);reveal.style.display='none';timeLeft=TIME_PER_Q;timeEl.innerText=timeLeft;timerBar.style.width='100%';startTimer()}function startTimer(){clearInterval(timer);timer=setInterval(()=>{timeLeft-=1;const pct=(timeLeft/TIME_PER_Q)*100;timerBar.style.width=pct+'%';timeEl.innerText=timeLeft;if(timeLeft<=0){clearInterval(timer);handleSkip('Time up')}} ,1000)}function revealAnswer(correctIdx,note){const correctText=pool[index].options[correctIdx];reveal.style.display='block';reveal.innerHTML='<div><strong>Correct:</strong> '+String.fromCharCode(65+correctIdx)+'. '+correctText+'</div><div class="muted small">'+note+'</div>'}function handleSubmit(){clearInterval(timer);const selected=oBox.querySelector('.opt-btn.selected');const correctIdx=pool[index].answer;if(!selected){score+=POINT_SKIP;revealAnswer(correctIdx,'No option selected. Skipped. -1 point')}else{const chosen=parseInt(selected.dataset.idx,10);if(chosen===correctIdx){score+=POINT_CORRECT;revealAnswer(correctIdx,'Correct! +5');selected.classList.add('selected')}else{score+=POINT_WRONG;revealAnswer(correctIdx,'Incorrect. -2');selected.classList.add('selected')}}scoreEl.innerText=score;setTimeout(()=>{index++;if(index>=TOTAL)finishExam();else updateUI()},1800)}function handleSkip(note){clearInterval(timer);const correctIdx=pool[index].answer;score+=POINT_SKIP;revealAnswer(correctIdx,note+' (Skipped) -1 point');scoreEl.innerText=score;setTimeout(()=>{index++;if(index>=TOTAL)finishExam();else updateUI()},1800)}submitBtn.addEventListener('click',handleSubmit);skipBtn.addEventListener('click',()=>handleSkip('User skipped'));endBtn.addEventListener('click',()=>{if(confirm('End test now?'))finishExam()});function finishExam(){clearInterval(timer);const hist=JSON.parse(localStorage.getItem('govt_history')||'[]');hist.push({email:user.email,name:user.name,domain,score,date:new Date().toISOString()});localStorage.setItem('govt_history',JSON.stringify(hist));sessionStorage.setItem('govt_last_result',JSON.stringify({name:user.name,domain,score,total:TOTAL,date:new Date().toISOString()}));localStorage.setItem('studentName',user.name);localStorage.setItem('examDomain',domain);localStorage.setItem('examScore',score);location.href='result.html'} }

/* Result page */
if(location.pathname.endsWith('result.html')){const last=JSON.parse(sessionStorage.getItem('govt_last_result')||'null');if(!last){location.href='index.html'}document.getElementById('resName').innerText=last.name;document.getElementById('resDomain').innerText=last.domain.replace(/_/g,' ');document.getElementById('resScore').innerText=last.score+' / '+(last.total*POINT_CORRECT);const pct=Math.max(0,Math.round((last.score/(last.total*POINT_CORRECT))*100));document.getElementById('finalBar').style.width=pct+'%';const msg=pct>=80?'Excellent â€” you are well-prepared for the exam.':pct>=50?'Good â€” keep practicing.':'Work harder â€” focus on basics and practice more.';document.getElementById('resMsg').innerText=msg;document.getElementById('retry').addEventListener('click',()=>location.href='exam.html');document.getElementById('logout').addEventListener('click',()=>{sessionStorage.removeItem('govt_current');location.href='index.html'});document.getElementById('getCert').addEventListener('click',()=>location.href='certificate.html')}

/* Certificate page */
document.addEventListener("DOMContentLoaded", () => {
  // ðŸŸ¢ Data load karaycha
  const last = JSON.parse(sessionStorage.getItem("govt_last_result") || "null");
  const name = localStorage.getItem("studentName") || (last && last.name) || "Student";
  const domain = localStorage.getItem("examDomain") || localStorage.getItem("selectedSubject") || (last && last.domain) || "Exam";
  const score = localStorage.getItem("examScore") || localStorage.getItem("studentScore") || (last && last.score) || "0";
  const date = last && last.date
    ? new Date(last.date).toLocaleDateString()
    : new Date().toLocaleDateString();

  // ðŸŸ¢ Certificate text
  const certText = document.getElementById("certText");
  if (!last) {
    certText.innerText = "No recent result found.";
  } else {
    certText.innerHTML = `
      This is proudly presented to <b>${name}</b><br/>
      for successfully completing the <b> Govt preparation Exam</b><br/>
      Subject: <b>${domain.replace(/_/g, " ")}</b> &nbsp; | &nbsp;
      Score: <b>${score}</b> &nbsp; | &nbsp;
      Date: <b>${date}</b>
    `;
  }

  // ðŸŸ¢ Download PDF button
  document.getElementById("downloadPdf").addEventListener("click", async () => {
    const { jsPDF } = window.jspdf;
    const node = document.querySelector(".certificate-box") || document.querySelector(".card");

    const canvas = await html2canvas(node, {
      scale: 2,
      useCORS: true,
      backgroundColor: null
    });

    const img = canvas.toDataURL("image/png");

    const pdf = new jsPDF({
      orientation: "landscape",
      unit: "px",
      format: [canvas.width, canvas.height]
    });

    pdf.addImage(img, "PNG", 0, 0, canvas.width, canvas.height);
    pdf.save((name ? name.replace(/[^A-Za-z0-9 ]/g, "") : "certificate") + "-certificate.pdf");

    // ðŸŸ¢ Student data Google Sheet madhe save karaycha
    const studentData = {
      name: name,
      domain: domain,
      score: score,
      date: date,
      certificate: "Downloaded"
    };

    fetch("https://script.google.com/macros/s/AKfycbztDQCRpb0z-TaRfPPhJQfGlTWUAd0718pRhNqgQeyzepMtErS30G8Fn8bMK81ryMNRAg/exec", {
  method: "POST",
  body: JSON.stringify(studentData)


    })
      .then(res => res.text())
      .then(msg => console.log("âœ… Saved to Google Sheet:", msg))
      .catch(err => console.error("âŒ Error saving to Sheet:", err));
  });

  // ðŸŸ¢ Print button
  document.getElementById("printBtn").addEventListener("click", () => {
    window.print();
  });
});
